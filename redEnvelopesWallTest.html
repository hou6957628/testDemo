<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--可视区域的定义，如屏幕缩放等。告诉浏览器如何规范的渲染网页-->
    <!--启用 webapp 模式, 会隐藏工具栏和菜单栏，和其它配合使用。-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!--在webapp模式下，改变顶部状态条的颜色。-->
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--屏蔽电话号码-->
    <meta name="format-detection" content="telephone=no">
    <title>红包墙</title>
    <link href="https://cdn.bootcss.com/animate.css/3.3.0/animate.min.css" rel="stylesheet">
    <script src="http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js"></script>
    <script src="http://jmyq.wzgeek.com/js/layer.js"></script>
    <style type="text/css">
        [v-cloak] {
            display: none;
        }
        *{
            -webkit-overflow-scrolling: touch;
        }
        html,body{
            width: 100%;
            background: url("http://jmyq.wzgeek.com/images/redEnvelopesBg.png") no-repeat no-repeat;
            background-size: cover;
            background-color: #e40003;
            overflow: auto;
        }
        .content{
            width: 94%;
            height: 11.5rem;
            margin: 0 auto;
            margin-top: 5rem;
        }
        .modal {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            overflow: hidden;
            outline: 0;
            -webkit-overflow-scrolling: touch;
            background-color: rgb(0, 0, 0);
            filter: alpha(opacity=60);
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 9999;
        }
        .renClass{
            position: absolute;
            width: 7.5rem;
            height: 8.88rem;
            left: 50%;
            top:50%;
            margin-left: -3.75rem;
            margin-top: -4.44rem;
        }
        .dakai{
            position: absolute;
            width: 7.5rem;
            height: 8.88rem;
            line-height: 8rem;
            text-align: center;
            left: 50%;
            top:50%;
            margin-left: -3.75rem;
            margin-top: -4.44rem;
            background: url("http://jmyq.wzgeek.com/images/dakai.png") no-repeat no-repeat;
            background-size: contain;
            background-color:#ffdea0;
            border-radius: 0.27rem;
            color: red;
            font-size: 0.6rem;
        }
        .dakai1{
            position: absolute;
            width: 7.5rem;
            height: 8.88rem;
            line-height: 8rem;
            text-align: center;
            left: 50%;
            top:50%;
            margin-left: -3.75rem;
            margin-top: -4.44rem;
            background: url("http://jmyq.wzgeek.com/images/nozhong.png") no-repeat no-repeat;
            background-size: contain;
            border-radius: 0.27rem;
            color: red;
            font-size: 0.6rem;
        }
        .dakai span{
            font-size: 1.4rem;
        }
        .closeBtn1{
            position: absolute;
            width: 0.93rem;
            height: 0.93rem;
            top: 82%;
            left: 50%;
            margin-left: -0.46rem;
        }
        .chouContent{
            width: 7.73rem;
            height: 6.93rem;
            line-height: 1rem;
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            background: url("http://123.56.12.92/images/lingqu.png") no-repeat no-repeat;
            background-size: 7.73rem 6.93rem;
            margin-left: -3.86rem;
            margin-top: -3.46rem;
            color: #000;
            font-size: 0.6rem;
        }
        .activeNo{
            color:#FB851E;
            border:2px solid rgba(252,138,35,1);
            border-radius:0.57rem;
            background-color: #fff;
        }
        .activeYes{
            font-weight:500;
            color: rgb(255, 255, 255);
            border:2px solid rgba(252,138,35,1);
            border-radius:0.57rem;
            background-color:#FB851E;
        }
        .xiaofei{
            width: 6.67rem;
            height: 0.48rem;
            line-height: 0.48rem;
            margin: 0 auto;
            margin-top: 3.12rem;
            font-size: 0.48rem;
            text-align: center;
        }
        .zongji{
            width: 6.67rem;
            height: 0.48rem;
            line-height: 0.48rem;
            margin: 0 auto;
            margin-top: 0.33rem;
            font-size: 0.4rem;
            text-align: center;
            letter-spacing: 0.03rem;
        }
        .ddaa{
            color: #F86115;
            font-size: 0.64rem;
            letter-spacing: 0.03rem;
        }
        .activeNo{
            display: inline-block;
            width: 2.8rem;
            height: 1.15rem;
            line-height: 1.15rem;
            margin-top: 0.57rem;
            font-size: 0.51rem;
            text-align: center;
        }
        .activeYes{
            display: inline-block;
            width: 2.8rem;
            height: 1.15rem;
            line-height: 1.15rem;
            margin-top: 0.57rem;
            font-size: 0.51rem;
            text-align: center;
            float: right;
        }
        .btnBox{
            width: 7rem;
        }
        .xiaofei1{
            width: 6.67rem;
            height: 0.48rem;
            line-height: 0.48rem;
            margin: 0 auto;
            margin-top: 3.12rem;
            font-size: 0.48rem;
            text-align: center;
            color:#3C352E;
        }
        .zongji2{
            width:5.33rem;
            height:0.85rem;
            margin: 0 auto;
            margin-top: 0.33rem;
            line-height: 0.4rem;
            font-size:0.37rem;
            font-weight:500;
            color:#666666;
        }
    </style>
</head>
<body>
<div id="app" v-cloak>
<div class="content" @click="openBg">
&nbsp;
</div>
<div class="modal" v-show="bg1">
        <div class="chouContent">
            <p class="xiaofei">花费{{currentAmount}}金币即可参于此活动</p>
            <p class="zongji">当前金币:<span class="ddaa">{{totalAmount}}个</span></p>
            <div class="btnBox">
                <span class="activeNo" @click="noBtn">不要</span>
                <span class="activeYes" @click="yesBtn">确定</span>
            </div>
        </div>
    </div>
<div class="modal" v-show="bg2">
        <div class="chouContent">
            <p class="xiaofei1">金币账户余额:0</p>
            <p class="zongji2">你的金币账户金币不足，去赚金币吧</p>
            <div class="btnBox">
                <span class="activeNo" @click="noBtn">暂时不要</span>
                <span class="activeYes" @click="goBtn">去赚金币</span>
            </div>
        </div>
    </div>
<div @click="chouBg" class="modal" v-show="bg">
    <img v-show="iii" @click.stop="drawRedEnvelopes" src="http://jmyq.wzgeek.com/images/openRed.png" :class="[this.flag?'tada':'']" class="animated infinite renClass">
    <div v-show="dakaiBg" class="dakai"><span>{{money}}</span>元</div>
    <div v-show="weizhong" class="dakai1"></div>
    <img @click="closeBg" class="closeBtn1" src="http://jmyq.wzgeek.com/images/closeW.png">
</div>
</div>
<script src="https://cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.6.5/vue.min.js"></script>
<script>
    function getToken(data) {
        localStorage.token=data;
    }
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    function stopScroll(e) {
        e.preventDefault()
    }
    var app = new Vue({
        el: '#app',
        data:{
            danImg:'',
            bg:false,
            money:5,
            dakaiBg:false,
            weizhong:false,
            flag:false,
            activeCode:"",
            iii:true,
            bg1:false,
            bg2:false,
            totalAmount:'',
            currentAmount:'',
        },
        mounted: function () {
            // this.getInfo();
            var activityId=getQueryString("activityId");
            this.activityId=activityId;
        },
        methods: {
            //点击红包墙查询用户是否有足够金币
            // getInfo: function () {
            //     $.ajax({
            //         headers:{
            //             'Content-Type':'application/x-www-form-urlencoded',
            //             'token': localStorage.token
            //         },
            //         // url:"http://60.205.216.141/flowPool/api/redPacketWall/beforeOpen",
            //         url:"http://47.93.234.167:31999/flowPool/api/redPacketWall/beforeOpen",
            //         type: "POST",
            //         success: function (data) {
            //             if(data.msgCd=="ZYCASH-200"){
            //                 app.bg=true;
            //                 app.iii=true;
            //             }else if(data.msgCd=="ZYCASH-8002"){
            //                 layer.open({
            //                     content: data.msgInfo
            //                     ,skin: 'msg'
            //                     ,time: 2 //2秒后自动关闭
            //                 });
            //             }
            //             else {
            //                 layer.open({
            //                     content: data.msgInfo
            //                     ,skin: 'msg'
            //                     ,time: 2 //2秒后自动关闭
            //                 });
            //             }
            //         }
            //     });
            // },

            //点击红包您每天有7次免费抽取的资格，七次后每次抽将取消耗5金币。
            getInfo: function () {
                $.ajax({
                    headers:{
                        'Content-Type':'application/x-www-form-urlencoded',
                        'token': localStorage.token
                    },
                    url:"http://60.205.216.141/flowPool/api/redPacketWall/beforeOpen",
                    // url:"http://47.93.234.167:31999/flowPool/api/redPacketWall/beforeOpen",
                    type: "POST",
                    success: function (data) {
                        if(data.msgCd=="ZYCASH-200"){
                            if(data.body.goldCoinPopup=="false"){
                                app.bg=true;
                                app.iii=true;
                            } else {
                                app.bg1=true;
                                app.totalAmount=data.body.totalAmount;
                                app.currentAmount=data.body.currentAmount;
                            }
                        }else if(data.msgCd=="ZYCASH-8012"){
                            app.bg2=true;
                            app.totalAmount=data.body.totalAmount;
                            app.currentAmount=data.body.currentAmount;
                        }
                        else {
                            app.sendMsg( data.msgInfo);
                        }
                    }
                });
            },
            //拆开红包
            openRedEnvelopes: function () {
            // class="animated bounce infinite"
                this.flag=true;
                $.ajax({
                    headers:{
                        'Content-Type':'application/x-www-form-urlencoded',
                        'token': localStorage.token
                    },
                    url:"http://60.205.216.141/flowPool/api/redPacketWall/open",
                    // url:"http://47.93.234.167:31999/flowPool/api/redPacketWall/open",
                    type: "POST",
                    data:{
                        activityId :app.activityId,
                    },
                    success: function (data) {
                        if(data.msgCd=="ZYCASH-200"){
                            app.money=data.body;
                            if(app.money==0.0){
                                app.iii=false;
                                app.weizhong=true;
                                app.flag=false;
                            }else {
                                app.dakaiBg=true;
                                app.flag=false;
                            }
                        }else if(data.msgCd=="ZYCASH-8002"){
                            app.sendMsg( data.msgInfo);
                            app.flag=false;
                        }
                        else {
                            app.sendMsg( data.msgInfo);
                            app.flag=false;
                        }
                    }
                });
            },
            sendMsg(data){
                let ua = navigator.userAgent.toLowerCase();
                //Android终端
                let isAndroid = ua.indexOf('Android') > -1 || ua.indexOf('Adr') > -1;
                //Ios终端
                let isiOS = !!ua.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
                if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {
                    alert(data);
                    //Ios
                } else if (/(Android)/i.test(navigator.userAgent)) {
                    //Android终端
                    window.control.signIn(data);
                }
            },
            chouBg:function () {
                document.querySelector('#app').removeEventListener('touchmove', stopScroll, false);
                this.dakaiBg=false;
                this.weizhong=false;
                this.bg=false;
            },
            openBg:function(){
                this.getInfo();
            },
            closeBg:function(){
                this.bg=false;
                this.dakaiBg=false;
                this.weizhong=false;
            },
            drawRedEnvelopes(){
                this.openRedEnvelopes();
            },
            noBtn:function(){
                app.bg1=false;
                app.bg2=false;
            },
            yesBtn:function(){
                app.bg=true;
                app.bg1=false;
                app.iii=true;
            },
            goBtn:function () {
                app.bg1=false;
                app.bg2=false;
                app.sendMsg("signIn");
            }
        },
    });
</script>
</body>
</html>